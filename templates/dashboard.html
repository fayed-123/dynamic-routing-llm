<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; background-color: #f0f2f5; color: #333; }
        .dashboard-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 30px; padding: 30px; max-width: 1200px; margin: auto; }
        .chart-card { background-color: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        h1 { text-align: center; color: #1a253c; }
        h2 { text-align: center; margin-top: 0; color: #444; }
    </style>
</head>
<body>
<h1>ðŸ“Š Live System Dashboard</h1>
<div class="dashboard-container">
    <div class="chart-card">
        <h2>Model Usage</h2>
        <canvas id="modelUsageChart"></canvas>
    </div>
    <div class="chart-card">
        <h2>Cache Performance</h2>
        <canvas id="cacheChart"></canvas>
    </div>
</div>

<script>
    // Get the canvas elements where the charts will be drawn.
    const modelCtx = document.getElementById('modelUsageChart').getContext('2d');
    const cacheCtx = document.getElementById('cacheChart').getContext('2d');

    // Initialize the model usage chart (doughnut type) with empty data.
    const modelUsageChart = new Chart(modelCtx, {
        type: 'doughnut',
        data: {
            labels: ['Simple', 'Medium', 'Advanced'],
            datasets: [{
                label: 'Model Usage Count',
                data: [0, 0, 0],
                backgroundColor: ['#4caf50', '#ffc107', '#f44336'],
            }]
        }
    });

    // Initialize the cache performance chart (bar type) with empty data.
    const cacheChart = new Chart(cacheCtx, {
        type: 'bar',
        data: {
            labels: ['Cache Hits', 'Cache Misses'],
            datasets: [{
                label: 'Cache Performance Count',
                data: [0, 0],
                backgroundColor: ['#2196f3', '#e0e0e0'],
            }]
        },
        options: { scales: { y: { beginAtZero: true } } }
    });

    // This async function fetches new data from the API and updates the charts.
    async function updateDashboard() {
        try {
            // Fetch the latest stats from our /api/stats endpoint.
            const response = await fetch('/api/stats');
            const stats = await response.json();

            // Update the Model Usage chart data if the data is valid.
            if (stats && stats.system && stats.system.model_usage) {
                const modelUsageData = stats.system.model_usage;
                modelUsageChart.data.datasets[0].data = [
                    modelUsageData.simple || 0,
                    modelUsageData.medium || 0,
                    modelUsageData.advanced || 0
                ];
                modelUsageChart.update();
            }

            // Update the Cache Performance chart data if the data is valid.
            if (stats && stats.cache) {
                const cacheData = stats.cache;
                cacheChart.data.datasets[0].data = [
                    cacheData.cache_hits || 0,
                    cacheData.cache_misses || 0
                ];
                cacheChart.update();
            }

            console.log("Dashboard updated successfully!");

        } catch (error) {
            console.error("Error updating dashboard:", error);
        }
    }

    // --- Run the update logic ---
    // 1. Update the dashboard immediately when the page loads.
    updateDashboard();

    // 2. Set an interval to update it automatically every 5 seconds.
    setInterval(updateDashboard, 5000);

</script>
</body>
</html>